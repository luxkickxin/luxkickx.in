<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LuxKickx.in</title>

<style>
body{
  margin:0;
  font-family:Poppins,Arial;
  background:#0f0f0f;
  color:white;
  text-align:center;
}
header{
  background:#111;
  padding:15px;
  font-size:1.8em;
  font-weight:bold;
}
.product-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
  padding:20px;
}
.product{
  background:#1b1b1b;
  border-radius:15px;
  padding:15px;
}
.product img{
  width:100%;
  height:200px;
  object-fit:cover;
  border-radius:10px;
}
button{
  background:#ff3131;
  color:white;
  border:none;
  padding:10px;
  border-radius:10px;
  cursor:pointer;
  margin-top:8px;
  width:100%;
}
input{
  width:95%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:none;
}
#adminPanel{
  display:none;
  background:#111;
  padding:20px;
  margin:20px auto;
  border-radius:10px;
  max-width:450px;
}
#loginButton{
  position:fixed;
  bottom:20px;
  right:20px;
  width:auto;
}
#loginBox{
  display:none;
  position:fixed;
  bottom:70px;
  right:20px;
  background:#111;
  padding:15px;
  border-radius:10px;
}
progress{
  width:100%;
  display:none;
}
</style>
</head>

<body>

<header>LuxKickx.in</header>

<button id="loginButton" onclick="toggleLogin()">Admin</button>

<div id="loginBox">
  <input type="password" id="adminPwd" placeholder="Admin Password">
  <button onclick="adminLogin()">Login</button>
  <button onclick="adminLogout()">Logout</button>
</div>

<div id="adminPanel">
  <h3>Admin Panel</h3>
  <input id="nameInput" placeholder="Product Name">
  <input id="priceInput" placeholder="Price">
  <input type="file" id="imgFile" accept="image/*">
  <progress id="uploadProgress" value="0" max="100"></progress>
  <button onclick="saveProduct()">Add / Update Product</button>
</div>

<div class="product-grid" id="productGrid"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
import { getStorage, ref as sRef, uploadBytesResumable, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

const firebaseConfig = {
 apiKey: "AIzaSyCYxb2C9DaT_j_SjFwmKEPV9NBKGiShJxM",
  authDomain: "luxkicx-7606f.firebaseapp.com",
  databaseURL: "https://luxkicx-7606f-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "luxkicx-7606f",
  storageBucket: "luxkicx-7606f.firebasestorage.app",
  messagingSenderId: "109211508096",
  appId: "1:109211508096:web:9c74e21f33dbf845fcb565"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

/* ðŸ” Admin Password */
const ADMIN_PASSWORD = "albin@123";

/* ðŸ“± WhatsApp Number */
const WHATSAPP_NUMBER = "919876543210"; // CHANGE THIS

let isAdmin = localStorage.getItem("isAdmin") === "true";
let editId = null;
let oldImage = null;

const adminPanel = document.getElementById("adminPanel");
const loginBox = document.getElementById("loginBox");
const grid = document.getElementById("productGrid");
const progress = document.getElementById("uploadProgress");

if (isAdmin) adminPanel.style.display = "block";

/* LOGIN */
window.toggleLogin = () => {
  loginBox.style.display = loginBox.style.display === "block" ? "none" : "block";
};

window.adminLogin = () => {
  if (adminPwd.value === ADMIN_PASSWORD) {
    isAdmin = true;
    localStorage.setItem("isAdmin","true");
    adminPanel.style.display = "block";
    loginBox.style.display = "none";
    alert("Admin login success");
  } else {
    alert("Wrong password");
  }
};

window.adminLogout = () => {
  isAdmin = false;
  localStorage.removeItem("isAdmin");
  adminPanel.style.display = "none";
};

/* IMAGE COMPRESS */
function compressImage(file){
  return new Promise(res=>{
    const img=new Image();
    img.src=URL.createObjectURL(file);
    img.onload=()=>{
      const c=document.createElement("canvas");
      const s=Math.min(1,800/img.width);
      c.width=img.width*s;
      c.height=img.height*s;
      c.getContext("2d").drawImage(img,0,0,c.width,c.height);
      c.toBlob(b=>res(b),"image/jpeg",0.75);
    };
  });
}

/* SAVE PRODUCT */
window.saveProduct = async ()=>{
  if(!isAdmin) return;

  const name=nameInput.value.trim();
  const price=priceInput.value.trim();
  const file=imgFile.files[0];

  if(!name || !price || (!file && !editId)){
    alert("Fill all fields");
    return;
  }

  let imageUrl = oldImage || "";
  progress.style.display="block";

  if(file){
    const blob=await compressImage(file);
    const imgRef=sRef(storage,"products/"+Date.now()+".jpg");
    const task=uploadBytesResumable(imgRef,blob);

    task.on("state_changed",s=>{
      progress.value=(s.bytesTransferred/s.totalBytes)*100;
    });

    await task;
    imageUrl=await getDownloadURL(imgRef);
    if(oldImage){
      try{await deleteObject(sRef(storage,oldImage));}catch{}
    }
  }

  if(editId){
    await set(ref(db,"products/"+editId),{name,price,img:imageUrl});
    editId=null; oldImage=null;
  }else{
    await push(ref(db,"products"),{name,price,img:imageUrl});
  }

  progress.style.display="none";
  progress.value=0;
  nameInput.value=priceInput.value="";
  imgFile.value="";
};

/* DELETE */
window.deleteProduct = async(id,img)=>{
  if(!isAdmin) return;
  if(!confirm("Delete product?")) return;
  await remove(ref(db,"products/"+id));
  try{await deleteObject(sRef(storage,img));}catch{}
};

/* EDIT */
window.editProduct = (id,p)=>{
  editId=id;
  oldImage=p.img;
  nameInput.value=p.name;
  priceInput.value=p.price;
};

/* BUY */
window.buyProduct = (name,price)=>{
  const msg = encodeURIComponent(`Hi! I want to buy ${name} (â‚¹${price})`);
  window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`,"_blank");
};

/* LOAD */
onValue(ref(db,"products"),snap=>{
  grid.innerHTML="";
  snap.forEach(c=>{
    const p=c.val();
    grid.innerHTML+=`
    <div class="product">
      <img src="${p.img}">
      <h3>${p.name}</h3>
      <p>â‚¹${p.price}</p>
      <button onclick="buyProduct('${p.name}','${p.price}')">Buy Now</button>
      ${isAdmin?
      `<button onclick='editProduct("${c.key}",${JSON.stringify(p)})'>Edit</button>
       <button onclick='deleteProduct("${c.key}","${p.img}")'>Delete</button>`:""}
    </div>`;
  });
});
</script>

</body>
</html>
